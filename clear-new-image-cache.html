
<!DOCTYPE html>
<html>
<head>
    <title>æ¸…ç†NewImageCacheç¼“å­˜</title>
</head>
<body>
    <h1>æ¸…ç†NewImageCacheç¼“å­˜</h1>
    <div id="status">æ­£åœ¨æ¸…ç†...</div>
    
    <script>
        (async () => {
            const status = document.getElementById('status');
            let clearedCount = 0;
            
            try {
                // æ¸…ç†æ‰€æœ‰å¯èƒ½çš„IndexedDBæ•°æ®åº“
                const dbNames = [
                    'unified-cache-v1',
                    'unified-cache', 
                    'image-cache',
                    'template-cache',
                    'thumbnail-cache',
                    'newImageCache',
                    'keyval-store'
                ];
                
                status.innerHTML = 'ğŸ”„ æ¸…ç†IndexedDBæ•°æ®åº“...<br>';
                
                for (const dbName of dbNames) {
                    try {
                        await new Promise((resolve, reject) => {
                            const deleteReq = indexedDB.deleteDatabase(dbName);
                            deleteReq.onerror = () => reject(deleteReq.error);
                            deleteReq.onsuccess = () => resolve();
                            deleteReq.onblocked = () => setTimeout(resolve, 1000);
                            setTimeout(() => reject(new Error('timeout')), 5000);
                        });
                        
                        status.innerHTML += 'âœ… å·²åˆ é™¤: ' + dbName + '<br>';
                        clearedCount++;
                    } catch (error) {
                        status.innerHTML += 'âš ï¸ æ¸…ç†: ' + dbName + ' (' + error.message + ')<br>';
                    }
                }
                
                // æ¸…ç†localStorageä¸­çš„å›¾ç‰‡ç¼“å­˜ç›¸å…³é¡¹
                status.innerHTML += '<br>ğŸ”„ æ¸…ç†localStorage...<br>';
                const keys = Object.keys(localStorage);
                let localStorageCleared = 0;
                
                keys.forEach(key => {
                    if (key.includes('img_') || 
                        key.includes('image') || 
                        key.includes('thumbnail') || 
                        key.includes('template') ||
                        key.includes('cache')) {
                        localStorage.removeItem(key);
                        localStorageCleared++;
                    }
                });
                
                status.innerHTML += 'âœ… æ¸…ç†localStorageé¡¹: ' + localStorageCleared + 'ä¸ª<br>';
                
                // æ¸…ç†sessionStorage
                sessionStorage.clear();
                status.innerHTML += 'âœ… æ¸…ç†sessionStorage<br>';
                
                // å¼ºåˆ¶åƒåœ¾å›æ”¶ï¼ˆå¦‚æœæ”¯æŒï¼‰
                if (window.gc) {
                    window.gc();
                    status.innerHTML += 'âœ… æ‰§è¡Œåƒåœ¾å›æ”¶<br>';
                }
                
                status.innerHTML += '<br><h2>ğŸ‰ æ¸…ç†å®Œæˆ</h2>';
                status.innerHTML += '<p>å·²æ¸…ç†IndexedDBæ•°æ®åº“: ' + clearedCount + 'ä¸ª</p>';
                status.innerHTML += '<p>å·²æ¸…ç†localStorageé¡¹: ' + localStorageCleared + 'ä¸ª</p>';
                status.innerHTML += '<p><strong>å»ºè®®åˆ·æ–°é¡µé¢æˆ–é‡å¯æµè§ˆå™¨ä»¥ç¡®ä¿å®Œå…¨æ¸…ç†</strong></p>';
                
                console.log('NewImageCacheç¼“å­˜æ¸…ç†å®Œæˆ');
                
            } catch (error) {
                status.innerHTML += '<br><div style="color:red">âŒ æ¸…ç†è¿‡ç¨‹å‡ºé”™: ' + error.message + '</div>';
                console.error('æ¸…ç†å¤±è´¥:', error);
            }
        })();
    </script>
</body>
</html>

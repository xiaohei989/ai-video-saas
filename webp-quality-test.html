<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebP 960x540 è´¨é‡0.95ä¸“ä¸šçº§æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .test-item {
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            background: white;
        }
        .test-item img {
            width: 100%;
            height: auto;
            display: block;
        }
        .test-info {
            padding: 15px;
            background: #f8f9fa;
        }
        .size-highlight {
            font-size: 1.2em;
            font-weight: bold;
            color: #007bff;
            margin-bottom: 8px;
        }
        .quality-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
            margin-bottom: 8px;
        }
        .excellent { background: #d4edda; color: #155724; }
        .good { background: #cce5ff; color: #004085; }
        .average { background: #fff3cd; color: #856404; }
        
        .summary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        .summary h3 {
            margin-top: 0;
            font-size: 1.3em;
        }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #0056b3;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #007bff;
        }
        .stat-label {
            color: #666;
            font-size: 0.9em;
            margin-top: 5px;
        }
        
        #loadingIndicator {
            text-align: center;
            padding: 20px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒŸ WebPä¸“ä¸šçº§æµ‹è¯•ï¼š960Ã—540 è´¨é‡0.95</h1>
        
        <div class="summary">
            <h3>ğŸ“Š æµ‹è¯•ç›®æ ‡</h3>
            <p>æµ‹è¯•å‡çº§åçš„ä¸“ä¸šçº§ç³»ç»Ÿé…ç½® (960Ã—540, WebPè´¨é‡0.95) çš„å®é™…æ•ˆæœå’Œæ–‡ä»¶å¤§å°</p>
            <ul>
                <li>åˆ†è¾¨ç‡ï¼š960Ã—540åƒç´  (16:9æ¯”ä¾‹ï¼Œ1.5å€æå‡)</li>
                <li>æ ¼å¼ï¼šWebP (ç°ä»£å‹ç¼©ç®—æ³•)</li>
                <li>è´¨é‡ï¼š0.95 (ä¸“ä¸šçº§è´¨é‡è®¾ç½®)</li>
                <li>åœºæ™¯ï¼šå¤æ‚å›¾åƒå’Œç®€å•å›¾åƒå¯¹æ¯”</li>
            </ul>
        </div>

        <button onclick="runQualityTest()">ğŸš€ å¼€å§‹æµ‹è¯•</button>
        <button onclick="generateComplexImage()">ğŸ¨ ç”Ÿæˆå¤æ‚å›¾åƒæµ‹è¯•</button>
        <button onclick="generateSimpleImage()">âšª ç”Ÿæˆç®€å•å›¾åƒæµ‹è¯•</button>

        <div id="loadingIndicator" style="display: none;">
            <p>ğŸ”„ æ­£åœ¨ç”Ÿæˆæµ‹è¯•å›¾åƒ...</p>
        </div>

        <div class="stats" id="statsContainer" style="display: none;">
            <div class="stat-item">
                <div class="stat-value" id="webpSize">-</div>
                <div class="stat-label">WebPæ–‡ä»¶å¤§å° (KB)</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="jpegSize">-</div>
                <div class="stat-label">JPEGæ–‡ä»¶å¤§å° (KB)</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="savings">-</div>
                <div class="stat-label">WebPèŠ‚çœç©ºé—´</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="loadTime">-</div>
                <div class="stat-label">é¢„ä¼°åŠ è½½æ—¶é—´</div>
            </div>
        </div>

        <div class="test-grid" id="testResults">
            <!-- æµ‹è¯•ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
        </div>

        <div id="conclusion" style="display: none;">
            <div class="summary">
                <h3>ğŸ¯ æµ‹è¯•ç»“è®º</h3>
                <div id="conclusionContent">
                    <!-- åŠ¨æ€ç”Ÿæˆç»“è®º -->
                </div>
            </div>
        </div>
    </div>

    <script>
        let testResults = {};

        function generateComplexImage() {
            const canvas = document.createElement('canvas');
            canvas.width = 960;  // ğŸš€ å‡çº§åˆ°ä¸“ä¸šçº§åˆ†è¾¨ç‡
            canvas.height = 540; // ğŸš€ å‡çº§åˆ°ä¸“ä¸šçº§åˆ†è¾¨ç‡
            const ctx = canvas.getContext('2d');

            // åˆ›å»ºå¤æ‚çš„æ¸å˜èƒŒæ™¯
            const gradient = ctx.createRadialGradient(480, 270, 0, 480, 270, 400);
            gradient.addColorStop(0, '#ff6b6b');
            gradient.addColorStop(0.3, '#4ecdc4');
            gradient.addColorStop(0.7, '#45b7d1');
            gradient.addColorStop(1, '#96ceb4');

            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, 960, 540);

            // æ·»åŠ æ›´å¤šå¤æ‚å›¾å½¢å’Œçº¹ç†ï¼ˆé€‚é…æ›´é«˜åˆ†è¾¨ç‡ï¼‰
            for (let i = 0; i < 80; i++) {
                ctx.fillStyle = `hsla(${Math.random() * 360}, 70%, 60%, 0.3)`;
                ctx.beginPath();
                ctx.arc(Math.random() * 960, Math.random() * 540, Math.random() * 35 + 15, 0, Math.PI * 2);
                ctx.fill();
            }

            // æ·»åŠ æ–‡å­—å’Œç»†èŠ‚
            ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
            ctx.font = 'bold 32px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('ä¸“ä¸šçº§å¤æ‚å›¾åƒæµ‹è¯• - 960Ã—540', 480, 270);
            
            ctx.font = '20px Arial';
            ctx.fillText('é«˜ç»†èŠ‚ã€å¤šé¢œè‰²ã€å¤æ‚çº¹ç†ã€ä¸“ä¸šçº§è´¨é‡', 480, 310);

            return canvas;
        }

        function generateSimpleImage() {
            const canvas = document.createElement('canvas');
            canvas.width = 960;  // ğŸš€ å‡çº§åˆ°ä¸“ä¸šçº§åˆ†è¾¨ç‡
            canvas.height = 540; // ğŸš€ å‡çº§åˆ°ä¸“ä¸šçº§åˆ†è¾¨ç‡
            const ctx = canvas.getContext('2d');

            // ç®€å•çš„åŒè‰²æ¸å˜
            const gradient = ctx.createLinearGradient(0, 0, 960, 540);
            gradient.addColorStop(0, '#667eea');
            gradient.addColorStop(1, '#764ba2');

            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, 960, 540);

            // ç®€å•çš„å‡ ä½•å›¾å½¢
            ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
            ctx.beginPath();
            ctx.arc(480, 270, 120, 0, Math.PI * 2);
            ctx.fill();

            // æ’­æ”¾æŒ‰é’®
            ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
            ctx.beginPath();
            ctx.moveTo(450, 240);
            ctx.lineTo(450, 300);
            ctx.lineTo(510, 270);
            ctx.closePath();
            ctx.fill();

            // ç®€å•æ–‡å­—
            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            ctx.font = 'bold 28px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('ä¸“ä¸šçº§ç®€å•å›¾åƒæµ‹è¯• - 960Ã—540', 480, 420);

            return canvas;
        }

        async function testImageQuality(canvas, type) {
            const results = {};
            
            // æµ‹è¯•ä¸“ä¸šçº§WebPè´¨é‡0.95
            const webpDataUrl = await new Promise((resolve) => {
                canvas.toBlob((blob) => {
                    if (blob) {
                        const reader = new FileReader();
                        reader.onload = () => resolve(reader.result);
                        reader.readAsDataURL(blob);
                    } else {
                        // WebPä¸æ”¯æŒæ—¶çš„å›é€€
                        resolve(canvas.toDataURL('image/jpeg', 0.95));
                    }
                }, 'image/webp', 0.95);
            });

            // æµ‹è¯•JPEGè´¨é‡0.95å¯¹æ¯”
            const jpegDataUrl = canvas.toDataURL('image/jpeg', 0.95);

            // è®¡ç®—æ–‡ä»¶å¤§å°
            const webpBase64 = webpDataUrl.split(',')[1];
            const jpegBase64 = jpegDataUrl.split(',')[1];
            
            const webpSizeKB = (webpBase64.length * 0.75 / 1024).toFixed(2);
            const jpegSizeKB = (jpegBase64.length * 0.75 / 1024).toFixed(2);
            
            const savings = (((jpegSizeKB - webpSizeKB) / jpegSizeKB) * 100).toFixed(1);

            results.webp = {
                dataUrl: webpDataUrl,
                sizeKB: parseFloat(webpSizeKB),
                format: 'WebP',
                quality: 0.95
            };

            results.jpeg = {
                dataUrl: jpegDataUrl,
                sizeKB: parseFloat(jpegSizeKB),
                format: 'JPEG',
                quality: 0.95
            };

            results.savings = parseFloat(savings);
            results.type = type;

            return results;
        }

        function displayResults(results) {
            const container = document.getElementById('testResults');
            const statsContainer = document.getElementById('statsContainer');
            
            // æ¸…ç©ºä¹‹å‰çš„ç»“æœ
            container.innerHTML = '';

            // æ˜¾ç¤ºWebPç»“æœ
            const webpItem = createTestItem(results.webp, 'ç³»ç»Ÿå½“å‰é…ç½®', 'excellent');
            container.appendChild(webpItem);

            // æ˜¾ç¤ºJPEGå¯¹æ¯”
            const jpegItem = createTestItem(results.jpeg, 'ä¼ ç»ŸJPEGå¯¹æ¯”', 'good');
            container.appendChild(jpegItem);

            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            document.getElementById('webpSize').textContent = results.webp.sizeKB;
            document.getElementById('jpegSize').textContent = results.jpeg.sizeKB;
            document.getElementById('savings').textContent = results.savings + '%';
            
            // è®¡ç®—é¢„ä¼°åŠ è½½æ—¶é—´ (å‡è®¾1Mbpsç½‘é€Ÿ)
            const loadTimeMs = (results.webp.sizeKB * 8 / 1000 * 1000).toFixed(0);
            document.getElementById('loadTime').textContent = loadTimeMs + 'ms';

            statsContainer.style.display = 'grid';

            // ä¿å­˜ç»“æœç”¨äºæ€»ç»“
            testResults[results.type] = results;

            showConclusion();
        }

        function createTestItem(result, title, badgeClass) {
            const item = document.createElement('div');
            item.className = 'test-item';

            const img = document.createElement('img');
            img.src = result.dataUrl;
            img.alt = title;

            const info = document.createElement('div');
            info.className = 'test-info';

            const qualityText = result.format === 'WebP' ? 'ğŸŒŸ ä¼˜ç§€' : 'ğŸ‘ è‰¯å¥½';

            info.innerHTML = `
                <div class="quality-badge ${badgeClass}">${qualityText}</div>
                <div class="size-highlight">${result.sizeKB} KB</div>
                <div><strong>${title}</strong></div>
                <div style="color: #666; font-size: 0.9em; margin-top: 8px;">
                    æ ¼å¼: ${result.format}<br>
                    è´¨é‡: ${result.quality}<br>
                    åˆ†è¾¨ç‡: 960Ã—540
                </div>
            `;

            item.appendChild(img);
            item.appendChild(info);
            return item;
        }

        function showConclusion() {
            const conclusion = document.getElementById('conclusion');
            const content = document.getElementById('conclusionContent');
            
            const hasResults = Object.keys(testResults).length > 0;
            if (!hasResults) return;

            // å–æœ€æ–°çš„æµ‹è¯•ç»“æœ
            const latest = Object.values(testResults)[Object.values(testResults).length - 1];
            
            let qualityAssessment = '';
            let recommendation = '';
            
            if (latest.webp.sizeKB < 40) {
                qualityAssessment = 'ğŸŒŸ ä¸“ä¸šçº§ä¼˜ç§€ï¼šè¶…é«˜è´¨é‡ï¼Œåˆç†å¤§å°';
                recommendation = 'ä¸“ä¸šçº§é…ç½®å®Œç¾å¹³è¡¡äº†æè‡´è´¨é‡å’Œå¯æ¥å—çš„æ–‡ä»¶å¤§å°ã€‚';
            } else if (latest.webp.sizeKB < 60) {
                qualityAssessment = 'âœ… ä¼˜ç§€ï¼šä¸“ä¸šçº§è´¨é‡ï¼Œæ€§èƒ½è‰¯å¥½';
                recommendation = '960Ã—540ä¸“ä¸šçº§é…ç½®æä¾›å“è¶Šçš„è§†è§‰ä½“éªŒã€‚';
            } else if (latest.webp.sizeKB < 80) {
                qualityAssessment = 'ğŸ‘ è‰¯å¥½ï¼šé«˜è´¨é‡ï¼Œæ–‡ä»¶ç¨å¤§';
                recommendation = 'ä¸“ä¸šçº§è´¨é‡å¸¦æ¥çš„å¤§æ–‡ä»¶æ˜¯å¯æ¥å—çš„æƒè¡¡ã€‚';
            } else {
                qualityAssessment = 'âš ï¸ æ³¨æ„ï¼šæ–‡ä»¶è¾ƒå¤§ï¼Œä½†è´¨é‡æä½³';
                recommendation = 'è¶…é«˜è´¨é‡é…ç½®ï¼Œé€‚åˆå¯¹è§†è§‰æ•ˆæœè¦æ±‚æé«˜çš„åœºæ™¯ã€‚';
            }

            content.innerHTML = `
                <h4>ğŸ“Š 960Ã—540 WebPè´¨é‡0.95 ä¸“ä¸šçº§åˆ†æ</h4>
                <ul>
                    <li><strong>æ–‡ä»¶å¤§å°</strong>: ${latest.webp.sizeKB} KB</li>
                    <li><strong>ç›¸æ¯”JPEGèŠ‚çœ</strong>: ${latest.savings}% ç©ºé—´</li>
                    <li><strong>è´¨é‡è¯„ä¼°</strong>: ${qualityAssessment}</li>
                    <li><strong>åŠ è½½æ€§èƒ½</strong>: é¢„è®¡${(latest.webp.sizeKB * 8 / 1000 * 1000).toFixed(0)}ms (1Mbpsç½‘ç»œ)</li>
                </ul>
                
                <h4>ğŸ’¡ ä¸“ä¸šå»ºè®®</h4>
                <p>${recommendation}</p>
                
                <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; margin-top: 15px;">
                    <strong>âœ¨ æ€»ç»“:</strong> 960Ã—540åˆ†è¾¨ç‡çš„WebPæ ¼å¼åœ¨è´¨é‡0.95ä¸“ä¸šçº§è®¾ç½®ä¸‹ï¼Œ
                    èƒ½å¤Ÿæä¾›æè‡´çš„è§†è§‰æ•ˆæœå’Œå‡ºè‰²çš„å‹ç¼©æ•ˆç‡ï¼Œå®Œç¾é€‚åˆé«˜ç«¯è§†é¢‘ç¼©ç•¥å›¾åº”ç”¨ã€‚
                    ç›¸æ¯”ä¼ ç»ŸJPEGæ ¼å¼ï¼Œå¹³å‡å¯èŠ‚çœ${latest.savings}%çš„å­˜å‚¨ç©ºé—´å’Œå¸¦å®½ã€‚
                </div>
            `;

            conclusion.style.display = 'block';
        }

        async function runQualityTest() {
            document.getElementById('loadingIndicator').style.display = 'block';
            
            try {
                // æµ‹è¯•å¤æ‚å›¾åƒ
                const complexCanvas = generateComplexImage();
                const complexResults = await testImageQuality(complexCanvas, 'complex');
                displayResults(complexResults);
                
            } catch (error) {
                console.error('æµ‹è¯•å¤±è´¥:', error);
                alert('æµ‹è¯•å¤±è´¥: ' + error.message);
            } finally {
                document.getElementById('loadingIndicator').style.display = 'none';
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è¿è¡Œæµ‹è¯•
        window.addEventListener('load', () => {
            setTimeout(runQualityTest, 500);
        });
    </script>
</body>
</html>
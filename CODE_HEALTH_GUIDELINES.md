# 代码健康维护指南

本文档提供了维护代码健康的最佳实践和工具使用指南。

## 🎯 目标

- 保持代码库整洁，避免死代码积累
- 定期检测和清理未使用的依赖
- 监控构建大小和性能
- 维护高质量的代码标准

## 🛠️ 可用工具

### 1. 死代码检测

```bash
# 运行所有死代码检测
npm run dead-code:all

# 单独运行 Knip (文件和依赖检测)
npm run dead-code:knip

# 单独运行 ts-prune (导出检测)
npm run dead-code:prune
```

### 2. 代码质量检查

```bash
# TypeScript 类型检查
npm run type-check

# ESLint 代码检查 (包含未使用导入检测)
npm run lint

# 完整的 CI 健康检查
npm run health-check:ci
```

### 3. 月度健康报告

```bash
# 生成详细的健康报告
npm run health-check
```

## 📋 维护流程

### 每日开发

1. **提交前检查**
   ```bash
   npm run health-check:ci
   ```

2. **修复 ESLint 警告**
   - 删除未使用的导入
   - 处理未使用的变量

### 每周维护

1. **运行死代码检测**
   ```bash
   npm run dead-code:all
   ```

2. **审查结果**
   - 检查未使用的文件
   - 评估未使用的依赖
   - 清理明显的死代码

### 月度深度清理

1. **生成健康报告**
   ```bash
   npm run health-check
   ```

2. **系统性清理**
   - 根据报告建议进行清理
   - 更新依赖包
   - 优化构建大小

## 🔍 清理优先级

### 高优先级 (立即清理)
- 明确的测试和调试文件
- 未使用的工具函数
- 废弃的组件

### 中优先级 (谨慎评估)
- 可能动态使用的服务
- 工具类和帮助函数
- UI 组件变体

### 低优先级 (保留观察)
- 类型定义
- 配置常量
- 可能的未来需求

## 🚫 注意事项

### 避免删除的代码
- 动态导入的模块
- 路由懒加载的组件
- 配置文件中引用的工具
- 类型定义文件

### 安全清理步骤
1. **确认未使用**: 多工具交叉验证
2. **搜索引用**: 全局搜索确认
3. **测试构建**: 删除后运行完整构建
4. **逐步清理**: 分批次进行，便于回滚

## 📊 阈值和指标

### 可接受范围
- 未使用导出: < 500 个
- Bundle 大小: < 4MB
- TypeScript 错误: 0 个
- 安全漏洞: 0 个

### 警告范围
- 未使用导出: 500-1000 个
- Bundle 大小: 4-6MB
- 安全漏洞: 1-5 个低危

### 需要立即处理
- 未使用导出: > 1000 个
- Bundle 大小: > 6MB
- 存在中高危安全漏洞

## 🔄 CI/CD 集成

项目已配置 GitHub Actions 自动化检查：

- **触发条件**: 
  - 推送到 main/develop 分支
  - 创建 Pull Request
  - 每周一定时运行

- **检查内容**:
  - TypeScript 类型检查
  - ESLint 规则验证
  - 死代码检测
  - 构建测试

## 📈 长期目标

1. **零容忍政策**
   - TypeScript 错误: 0
   - 安全漏洞: 0
   - 构建警告: 最小化

2. **持续优化**
   - 定期依赖更新
   - 性能监控
   - 代码质量提升

3. **自动化程度**
   - 自动化检测
   - 智能清理建议
   - 趋势分析

## 🆘 故障排除

### 常见问题

1. **Knip 误报**: 检查 `knip.config.js` 配置
2. **构建失败**: 确认所有依赖都已正确安装
3. **类型错误**: 检查是否误删了类型定义

### 联系支持

如果遇到问题：
1. 查看 `health-reports/` 目录下的详细报告
2. 检查 GitHub Actions 运行日志
3. 参考项目文档和配置文件

---

**记住**: 代码健康是一个持续的过程，需要团队成员的共同努力和定期维护。
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç½‘ç»œé—®é¢˜è¯Šæ–­æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f5f5f5;
            line-height: 1.6;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 2px solid #ddd;
            border-radius: 8px;
        }
        .error { border-color: #ff6b6b; background-color: #fff5f5; }
        .warning { border-color: #ffa500; background-color: #fff8e1; }
        .success { border-color: #51cf66; background-color: #f8fff8; }
        .info { border-color: #339af0; background-color: #e7f5ff; }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 8px;
            font-size: 16px;
            min-height: 48px;
            min-width: 120px;
        }
        button:hover { background: #0056b3; }
        button:active { background: #004085; }
        
        .test-button { background: #28a745; }
        .test-button:hover { background: #1e7e34; }
        
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 6px;
            font-family: monospace;
            white-space: pre-wrap;
            font-size: 14px;
        }
        .result.success { background: #d4edda; border: 1px solid #c3e6cb; }
        .result.error { background: #f8d7da; border: 1px solid #f5c6cb; }
        .result.info { background: #d1ecf1; border: 1px solid #b8daff; }
        
        .protocol-warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }
        
        video {
            width: 100%;
            max-width: 400px;
            height: auto;
            border-radius: 6px;
            border: 2px solid #ddd;
        }
        
        .progress {
            width: 100%;
            height: 4px;
            background: #f0f0f0;
            border-radius: 2px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-bar {
            height: 100%;
            background: #007bff;
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .network-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        .network-info div {
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
            border-left: 4px solid #007bff;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” ç½‘ç»œé—®é¢˜è¯Šæ–­æµ‹è¯•å·¥å…·</h1>
        
        <div class="protocol-warning">
            <h3>âš ï¸ æ£€æµ‹åˆ°çš„é—®é¢˜ï¼šNETWORK_NO_SOURCE</h3>
            <p><strong>é—®é¢˜åŸå› ï¼š</strong></p>
            <ul>
                <li><strong>æ··åˆå†…å®¹å®‰å…¨ç­–ç•¥ï¼š</strong>HTTPé¡µé¢æ— æ³•åŠ è½½HTTPSè§†é¢‘èµ„æº</li>
                <li><strong>ç½‘ç»œè¿æ¥é—®é¢˜ï¼š</strong>CDNæœåŠ¡å™¨å¯èƒ½æ— æ³•è®¿é—®</li>  
                <li><strong>DNSè§£æé—®é¢˜ï¼š</strong>åŸŸåè§£æå¯èƒ½å¤±è´¥</li>
                <li><strong>ç§»åŠ¨ç½‘ç»œé™åˆ¶ï¼š</strong>è¿è¥å•†å¯èƒ½é™åˆ¶æŸäº›åŸŸåè®¿é—®</li>
            </ul>
        </div>

        <!-- ç½‘ç»œç¯å¢ƒæ£€æµ‹ -->
        <div class="section info">
            <h3>ğŸŒ ç½‘ç»œç¯å¢ƒæ£€æµ‹</h3>
            <div class="network-info" id="networkInfo">
                <div><strong>æ­£åœ¨æ£€æµ‹ç½‘ç»œç¯å¢ƒ...</strong></div>
            </div>
            <button class="test-button" onclick="detectNetworkEnvironment()">ğŸ” æ£€æµ‹ç½‘ç»œç¯å¢ƒ</button>
            <div id="networkResult" class="result" style="display: none;"></div>
        </div>

        <!-- CDNè¿é€šæ€§æµ‹è¯• -->
        <div class="section warning">
            <h3>ğŸ“¡ CDNè¿é€šæ€§æµ‹è¯•</h3>
            <p>æµ‹è¯•å„ä¸ªCDNåŸŸåçš„å¯è®¿é—®æ€§</p>
            <button class="test-button" onclick="testCDNConnectivity()">ğŸš€ æµ‹è¯•CDNè¿é€šæ€§</button>
            <div class="progress" id="cdnProgress" style="display: none;">
                <div class="progress-bar" id="cdnProgressBar"></div>
            </div>
            <div id="cdnResult" class="result" style="display: none;"></div>
        </div>

        <!-- é—®é¢˜è§†é¢‘ç›´æ¥è®¿é—®æµ‹è¯• -->
        <div class="section error">
            <h3>ğŸš¨ é—®é¢˜è§†é¢‘ç›´æ¥è®¿é—®æµ‹è¯•</h3>
            <p><strong>é—®é¢˜è§†é¢‘ï¼š</strong>fireplace-seduction-selfie.mp4</p>
            <p><strong>URLï¼š</strong><span id="problemVideoUrl">https://cdn.veo3video.me/templates/videos/fireplace-seduction-selfie.mp4?v=1758008502567</span></p>
            
            <button class="test-button" onclick="testDirectVideoAccess('problem')">ğŸ¯ ç›´æ¥è®¿é—®æµ‹è¯•</button>
            <button onclick="downloadVideoHead('problem')">ğŸ“Š è·å–Headerä¿¡æ¯</button>
            <button onclick="tryAlternativeUrls('problem')">ğŸ”„ å°è¯•æ›¿ä»£URL</button>
            
            <div id="problemResult" class="result" style="display: none;"></div>
        </div>

        <!-- å¯¹æ¯”è§†é¢‘æµ‹è¯• -->
        <div class="section success">
            <h3>âœ… å¯¹æ¯”è§†é¢‘ç›´æ¥è®¿é—®æµ‹è¯•</h3>
            <p><strong>å¯¹æ¯”è§†é¢‘ï¼š</strong>asmr-surreal-toast-spread.mp4</p>
            <p><strong>URLï¼š</strong><span id="normalVideoUrl">https://cdn.veo3video.me/templates/videos/asmr-surreal-toast-spread.mp4</span></p>
            
            <button class="test-button" onclick="testDirectVideoAccess('normal')">ğŸ¯ ç›´æ¥è®¿é—®æµ‹è¯•</button>
            <button onclick="downloadVideoHead('normal')">ğŸ“Š è·å–Headerä¿¡æ¯</button>
            
            <div id="normalResult" class="result" style="display: none;"></div>
        </div>

        <!-- å®é™…è§†é¢‘æ’­æ”¾æµ‹è¯• -->
        <div class="section">
            <h3>ğŸ¬ å®é™…è§†é¢‘æ’­æ”¾æµ‹è¯•</h3>
            <p>åœ¨ç¡®è®¤ç½‘ç»œè¿é€šæ€§åè¿›è¡Œå®é™…æ’­æ”¾æµ‹è¯•</p>
            
            <div style="margin: 20px 0;">
                <h4>é—®é¢˜è§†é¢‘æ’­æ”¾æµ‹è¯•</h4>
                <video id="testProblemVideo" controls preload="none" webkit-playsinline playsinline>
                    <source src="https://cdn.veo3video.me/templates/videos/fireplace-seduction-selfie.mp4?v=1758008502567" type="video/mp4">
                </video>
                <div>
                    <button onclick="testVideoPlayback('testProblemVideo', 'problem')">â–¶ï¸ æµ‹è¯•æ’­æ”¾</button>
                    <button onclick="loadVideoMetadata('testProblemVideo', 'problem')">ğŸ“‹ åŠ è½½å…ƒæ•°æ®</button>
                </div>
                <div id="testProblemResult" class="result" style="display: none;"></div>
            </div>

            <div style="margin: 20px 0;">
                <h4>å¯¹æ¯”è§†é¢‘æ’­æ”¾æµ‹è¯•</h4>
                <video id="testNormalVideo" controls preload="none" webkit-playsinline playsinline>
                    <source src="https://cdn.veo3video.me/templates/videos/asmr-surreal-toast-spread.mp4" type="video/mp4">
                </video>
                <div>
                    <button onclick="testVideoPlayback('testNormalVideo', 'normal')">â–¶ï¸ æµ‹è¯•æ’­æ”¾</button>
                    <button onclick="loadVideoMetadata('testNormalVideo', 'normal')">ğŸ“‹ åŠ è½½å…ƒæ•°æ®</button>
                </div>
                <div id="testNormalResult" class="result" style="display: none;"></div>
            </div>
        </div>

        <!-- è§£å†³æ–¹æ¡ˆå»ºè®® -->
        <div class="section info">
            <h3>ğŸ’¡ è§£å†³æ–¹æ¡ˆå»ºè®®</h3>
            <div id="solutionSuggestions">
                <p>è¯·å…ˆè¿›è¡Œä¸Šè¿°æµ‹è¯•ï¼Œç³»ç»Ÿå°†æ ¹æ®æµ‹è¯•ç»“æœæä¾›é’ˆå¯¹æ€§çš„è§£å†³æ–¹æ¡ˆã€‚</p>
            </div>
        </div>
    </div>

    <script>
        let testResults = {};

        // ç½‘ç»œç¯å¢ƒæ£€æµ‹
        function detectNetworkEnvironment() {
            const result = document.getElementById('networkResult');
            result.style.display = 'block';
            result.className = 'result info';
            
            const env = {
                userAgent: navigator.userAgent,
                protocol: location.protocol,
                hostname: location.hostname,
                port: location.port,
                isHTTPS: location.protocol === 'https:',
                connectionType: navigator.connection ? navigator.connection.effectiveType : 'æœªçŸ¥',
                onLine: navigator.onLine,
                language: navigator.language,
                platform: navigator.platform,
                cookieEnabled: navigator.cookieEnabled,
                doNotTrack: navigator.doNotTrack,
                hardwareConcurrency: navigator.hardwareConcurrency,
                maxTouchPoints: navigator.maxTouchPoints,
                screenWidth: screen.width,
                screenHeight: screen.height,
                devicePixelRatio: window.devicePixelRatio,
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone
            };

            const networkInfo = document.getElementById('networkInfo');
            networkInfo.innerHTML = `
                <div><strong>åè®®:</strong> ${env.protocol} ${env.isHTTPS ? 'ğŸ”’' : 'âš ï¸'}</div>
                <div><strong>ä¸»æœº:</strong> ${env.hostname}:${env.port || 'é»˜è®¤'}</div>
                <div><strong>è¿æ¥ç±»å‹:</strong> ${env.connectionType}</div>
                <div><strong>åœ¨çº¿çŠ¶æ€:</strong> ${env.onLine ? 'âœ… åœ¨çº¿' : 'âŒ ç¦»çº¿'}</div>
                <div><strong>è®¾å¤‡:</strong> ${env.platform}</div>
                <div><strong>è¯­è¨€:</strong> ${env.language}</div>
                <div><strong>æ—¶åŒº:</strong> ${env.timezone}</div>
                <div><strong>åƒç´ æ¯”:</strong> ${env.devicePixelRatio}</div>
            `;

            let analysis = `ğŸŒ ç½‘ç»œç¯å¢ƒåˆ†ææŠ¥å‘Š\n\n`;
            analysis += `åŸºæœ¬ä¿¡æ¯:\n`;
            analysis += `- åè®®: ${env.protocol} ${env.isHTTPS ? '(å®‰å…¨)' : '(ä¸å®‰å…¨)'}\n`;
            analysis += `- è¿æ¥: ${env.connectionType} ${env.onLine ? '(åœ¨çº¿)' : '(ç¦»çº¿)'}\n`;
            analysis += `- è®¾å¤‡: ${env.platform}\n`;
            analysis += `- æµè§ˆå™¨: ${getBrowserInfo()}\n\n`;

            if (!env.isHTTPS) {
                analysis += `âš ï¸ é‡è¦å‘ç°: å½“å‰ä½¿ç”¨HTTPåè®®\n`;
                analysis += `å½±å“: ç°ä»£æµè§ˆå™¨é™åˆ¶HTTPé¡µé¢åŠ è½½HTTPSèµ„æº\n`;
                analysis += `å»ºè®®: ä½¿ç”¨HTTPSåè®®è®¿é—®æœ¬é¡µé¢\n\n`;
            }

            if (!env.onLine) {
                analysis += `âŒ ä¸¥é‡é—®é¢˜: è®¾å¤‡æ˜¾ç¤ºä¸ºç¦»çº¿çŠ¶æ€\n`;
                analysis += `å»ºè®®: æ£€æŸ¥ç½‘ç»œè¿æ¥\n\n`;
            }

            testResults.network = env;
            result.textContent = analysis;
            
            alert(`ç½‘ç»œç¯å¢ƒæ£€æµ‹å®Œæˆ!\n\nåè®®: ${env.protocol}\nåœ¨çº¿: ${env.onLine ? 'æ˜¯' : 'å¦'}\nè¿æ¥: ${env.connectionType}`);
        }

        function getBrowserInfo() {
            const ua = navigator.userAgent;
            if (ua.includes('CriOS')) return 'Chrome (iOS)';
            if (ua.includes('Chrome') && !ua.includes('Edge')) return 'Chrome';
            if (ua.includes('Firefox')) return 'Firefox';
            if (ua.includes('Safari') && !ua.includes('Chrome')) return 'Safari';
            if (ua.includes('Edge')) return 'Edge';
            return 'æœªçŸ¥æµè§ˆå™¨';
        }

        // CDNè¿é€šæ€§æµ‹è¯•
        function testCDNConnectivity() {
            const result = document.getElementById('cdnResult');
            const progress = document.getElementById('cdnProgress');
            const progressBar = document.getElementById('cdnProgressBar');
            
            result.style.display = 'block';
            progress.style.display = 'block';
            result.className = 'result info';
            result.textContent = 'æ­£åœ¨æµ‹è¯•CDNè¿é€šæ€§...';

            const testUrls = [
                'https://cdn.veo3video.me/',
                'https://cdn.veo3video.me/templates/',
                'https://cdn.veo3video.me/templates/videos/',
                'https://cdn.veo3video.me/templates/videos/asmr-surreal-toast-spread.mp4',
                'https://cdn.veo3video.me/templates/videos/fireplace-seduction-selfie.mp4'
            ];

            let completed = 0;
            let results = [];

            testUrls.forEach((url, index) => {
                const startTime = Date.now();
                
                fetch(url, { 
                    method: 'HEAD',
                    cache: 'no-cache',
                    mode: 'cors'
                })
                .then(response => {
                    const elapsed = Date.now() - startTime;
                    results.push({
                        url,
                        status: response.status,
                        success: response.ok,
                        time: elapsed,
                        headers: {
                            contentType: response.headers.get('content-type'),
                            contentLength: response.headers.get('content-length'),
                            server: response.headers.get('server'),
                            cacheControl: response.headers.get('cache-control')
                        }
                    });
                })
                .catch(error => {
                    const elapsed = Date.now() - startTime;
                    results.push({
                        url,
                        success: false,
                        error: error.message,
                        time: elapsed
                    });
                })
                .finally(() => {
                    completed++;
                    const progressPercent = (completed / testUrls.length) * 100;
                    progressBar.style.width = progressPercent + '%';
                    
                    if (completed === testUrls.length) {
                        displayCDNResults(results);
                        progress.style.display = 'none';
                    }
                });
            });
        }

        function displayCDNResults(results) {
            const resultDiv = document.getElementById('cdnResult');
            let analysis = `ğŸ“¡ CDNè¿é€šæ€§æµ‹è¯•ç»“æœ\n\n`;
            
            const successful = results.filter(r => r.success).length;
            const total = results.length;
            
            analysis += `æ€»ä½“ç»“æœ: ${successful}/${total} æˆåŠŸ (${(successful/total*100).toFixed(1)}%)\n\n`;
            
            results.forEach((result, index) => {
                analysis += `${index + 1}. ${result.success ? 'âœ…' : 'âŒ'} ${result.url}\n`;
                if (result.success) {
                    analysis += `   çŠ¶æ€: ${result.status} | è€—æ—¶: ${result.time}ms\n`;
                    if (result.headers.contentLength) {
                        const sizeMB = (parseInt(result.headers.contentLength) / 1024 / 1024).toFixed(2);
                        analysis += `   å¤§å°: ${sizeMB}MB | ç±»å‹: ${result.headers.contentType}\n`;
                    }
                } else {
                    analysis += `   é”™è¯¯: ${result.error} | è€—æ—¶: ${result.time}ms\n`;
                }
                analysis += `\n`;
            });

            if (successful === 0) {
                analysis += `ğŸš¨ ä¸¥é‡é—®é¢˜: æ— æ³•è®¿é—®ä»»ä½•CDNèµ„æº\n`;
                analysis += `å¯èƒ½åŸå› :\n`;
                analysis += `1. ç½‘ç»œè¿æ¥é—®é¢˜\n`;
                analysis += `2. DNSè§£æå¤±è´¥\n`;
                analysis += `3. é˜²ç«å¢™æˆ–ä»£ç†é˜»æ­¢\n`;
                analysis += `4. CDNæœåŠ¡å•†åŒºåŸŸé™åˆ¶\n`;
            } else if (successful < total) {
                analysis += `âš ï¸ éƒ¨åˆ†é—®é¢˜: æŸäº›èµ„æºæ— æ³•è®¿é—®\n`;
                analysis += `å»ºè®®æ£€æŸ¥å…·ä½“å¤±è´¥çš„èµ„æº\n`;
            } else {
                analysis += `âœ… è¿é€šæ€§è‰¯å¥½: æ‰€æœ‰CDNèµ„æºå‡å¯è®¿é—®\n`;
            }

            testResults.cdn = results;
            resultDiv.className = successful > 0 ? 'result success' : 'result error';
            resultDiv.textContent = analysis;
            
            const summary = `CDNæµ‹è¯•å®Œæˆ!\næˆåŠŸ: ${successful}/${total}\n${successful === 0 ? 'æ‰€æœ‰èµ„æºéƒ½æ— æ³•è®¿é—®' : successful === total ? 'æ‰€æœ‰èµ„æºéƒ½å¯ä»¥è®¿é—®' : 'éƒ¨åˆ†èµ„æºæ— æ³•è®¿é—®'}`;
            alert(summary);
        }

        // ç›´æ¥è§†é¢‘è®¿é—®æµ‹è¯•
        function testDirectVideoAccess(type) {
            const url = type === 'problem' 
                ? 'https://cdn.veo3video.me/templates/videos/fireplace-seduction-selfie.mp4?v=1758008502567'
                : 'https://cdn.veo3video.me/templates/videos/asmr-surreal-toast-spread.mp4';
            
            const resultDiv = document.getElementById(type + 'Result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.textContent = 'æ­£åœ¨æµ‹è¯•ç›´æ¥è®¿é—®...';

            const startTime = Date.now();

            fetch(url, { 
                method: 'HEAD',
                cache: 'no-cache' 
            })
            .then(response => {
                const elapsed = Date.now() - startTime;
                let analysis = `ğŸ¯ ç›´æ¥è®¿é—®æµ‹è¯•ç»“æœ (${type})\n\n`;
                analysis += `URL: ${url}\n`;
                analysis += `çŠ¶æ€: ${response.status} ${response.statusText}\n`;
                analysis += `è€—æ—¶: ${elapsed}ms\n`;
                analysis += `æˆåŠŸ: ${response.ok ? 'âœ… æ˜¯' : 'âŒ å¦'}\n\n`;

                if (response.ok) {
                    analysis += `å“åº”å¤´ä¿¡æ¯:\n`;
                    analysis += `- Content-Type: ${response.headers.get('content-type')}\n`;
                    analysis += `- Content-Length: ${response.headers.get('content-length')}\n`;
                    analysis += `- Server: ${response.headers.get('server')}\n`;
                    analysis += `- Cache-Control: ${response.headers.get('cache-control')}\n`;
                    analysis += `- Access-Control-Allow-Origin: ${response.headers.get('access-control-allow-origin')}\n`;
                    
                    const contentLength = response.headers.get('content-length');
                    if (contentLength) {
                        const sizeMB = (parseInt(contentLength) / 1024 / 1024).toFixed(2);
                        analysis += `\næ–‡ä»¶å¤§å°: ${sizeMB}MB\n`;
                        analysis += `é¢„ä¼°ä¸‹è½½æ—¶é—´ (3G): ${(sizeMB * 8).toFixed(1)}ç§’\n`;
                    }
                    
                    resultDiv.className = 'result success';
                    analysis += `\nâœ… ç»“è®º: è§†é¢‘æ–‡ä»¶å¯ä»¥ç›´æ¥è®¿é—®\n`;
                } else {
                    resultDiv.className = 'result error';
                    analysis += `\nâŒ ç»“è®º: è§†é¢‘æ–‡ä»¶æ— æ³•è®¿é—®\n`;
                    analysis += `é”™è¯¯ä»£ç : ${response.status}\n`;
                }

                resultDiv.textContent = analysis;
                alert(`ç›´æ¥è®¿é—®æµ‹è¯•å®Œæˆ!\nçŠ¶æ€: ${response.status}\næˆåŠŸ: ${response.ok ? 'æ˜¯' : 'å¦'}`);
            })
            .catch(error => {
                const elapsed = Date.now() - startTime;
                const analysis = `âŒ ç›´æ¥è®¿é—®å¤±è´¥\n\né”™è¯¯: ${error.message}\nè€—æ—¶: ${elapsed}ms\n\nå¯èƒ½åŸå› :\n1. ç½‘ç»œè¿æ¥é—®é¢˜\n2. DNSè§£æå¤±è´¥\n3. æœåŠ¡å™¨ä¸å¯è®¿é—®\n4. CORSç­–ç•¥é˜»æ­¢`;
                
                resultDiv.className = 'result error';
                resultDiv.textContent = analysis;
                alert(`ç›´æ¥è®¿é—®å¤±è´¥!\né”™è¯¯: ${error.message}`);
            });
        }

        // è§†é¢‘æ’­æ”¾æµ‹è¯•
        function testVideoPlayback(videoId, type) {
            const video = document.getElementById(videoId);
            const resultDiv = document.getElementById('test' + type.charAt(0).toUpperCase() + type.slice(1) + 'Result');
            
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.textContent = 'æ­£åœ¨æµ‹è¯•è§†é¢‘æ’­æ”¾...';

            const startTime = Date.now();
            const events = [];

            // ç›‘å¬æ‰€æœ‰ç›¸å…³äº‹ä»¶
            const eventTypes = ['loadstart', 'loadedmetadata', 'loadeddata', 'canplay', 'canplaythrough', 'play', 'playing', 'error', 'abort', 'stalled', 'waiting'];
            
            eventTypes.forEach(eventType => {
                video.addEventListener(eventType, function(e) {
                    const elapsed = Date.now() - startTime;
                    events.push(`[${elapsed}ms] ${eventType}`);
                    
                    if (eventType === 'error' || eventType === 'abort') {
                        const error = e.target.error;
                        displayPlaybackResult(resultDiv, false, events, error, elapsed);
                    } else if (eventType === 'playing') {
                        displayPlaybackResult(resultDiv, true, events, null, elapsed);
                    }
                }, { once: true });
            });

            // å¼€å§‹æ’­æ”¾æµ‹è¯•
            video.load();
            setTimeout(() => {
                video.play().catch(error => {
                    const elapsed = Date.now() - startTime;
                    displayPlaybackResult(resultDiv, false, events, error, elapsed);
                });
            }, 500);
        }

        function displayPlaybackResult(resultDiv, success, events, error, elapsed) {
            let analysis = `ğŸ¬ è§†é¢‘æ’­æ”¾æµ‹è¯•ç»“æœ\n\n`;
            analysis += `ç»“æœ: ${success ? 'âœ… æ’­æ”¾æˆåŠŸ' : 'âŒ æ’­æ”¾å¤±è´¥'}\n`;
            analysis += `æ€»è€—æ—¶: ${elapsed}ms\n\n`;
            
            analysis += `äº‹ä»¶æ—¥å¿—:\n`;
            events.forEach(event => {
                analysis += `${event}\n`;
            });
            
            if (error) {
                analysis += `\né”™è¯¯ä¿¡æ¯:\n`;
                analysis += `- é”™è¯¯ç±»å‹: ${error.name}\n`;
                analysis += `- é”™è¯¯æ¶ˆæ¯: ${error.message}\n`;
                analysis += `- é”™è¯¯ä»£ç : ${error.code || 'æœªæä¾›'}\n`;
            }

            resultDiv.className = success ? 'result success' : 'result error';
            resultDiv.textContent = analysis;
        }

        // åŠ è½½è§†é¢‘å…ƒæ•°æ®
        function loadVideoMetadata(videoId, type) {
            const video = document.getElementById(videoId);
            const resultDiv = document.getElementById('test' + type.charAt(0).toUpperCase() + type.slice(1) + 'Result');
            
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.textContent = 'æ­£åœ¨åŠ è½½è§†é¢‘å…ƒæ•°æ®...';

            video.addEventListener('loadedmetadata', function() {
                const analysis = `ğŸ“‹ è§†é¢‘å…ƒæ•°æ®\n\nå°ºå¯¸: ${video.videoWidth}x${video.videoHeight}\næ—¶é•¿: ${video.duration.toFixed(2)}ç§’\nç½‘ç»œçŠ¶æ€: ${getNetworkState(video.networkState)}\nå°±ç»ªçŠ¶æ€: ${getReadyState(video.readyState)}`;
                resultDiv.className = 'result success';
                resultDiv.textContent = analysis;
            }, { once: true });

            video.addEventListener('error', function(e) {
                const error = e.target.error;
                const analysis = `âŒ å…ƒæ•°æ®åŠ è½½å¤±è´¥\n\né”™è¯¯ä»£ç : ${error ? error.code : 'æœªçŸ¥'}\né”™è¯¯ä¿¡æ¯: ${error ? getMediaErrorMessage(error.code) : 'æ— è¯¦ç»†ä¿¡æ¯'}`;
                resultDiv.className = 'result error';
                resultDiv.textContent = analysis;
            }, { once: true });

            video.load();
        }

        function getNetworkState(state) {
            const states = ['NETWORK_EMPTY', 'NETWORK_IDLE', 'NETWORK_LOADING', 'NETWORK_NO_SOURCE'];
            return states[state] || `æœªçŸ¥çŠ¶æ€: ${state}`;
        }

        function getReadyState(state) {
            const states = ['HAVE_NOTHING', 'HAVE_METADATA', 'HAVE_CURRENT_DATA', 'HAVE_FUTURE_DATA', 'HAVE_ENOUGH_DATA'];
            return states[state] || `æœªçŸ¥çŠ¶æ€: ${state}`;
        }

        function getMediaErrorMessage(code) {
            const messages = {
                1: 'MEDIA_ERR_ABORTED - ç”¨æˆ·å–æ¶ˆäº†è§†é¢‘åŠ è½½',
                2: 'MEDIA_ERR_NETWORK - ç½‘ç»œé”™è¯¯å¯¼è‡´è§†é¢‘ä¸‹è½½å¤±è´¥',
                3: 'MEDIA_ERR_DECODE - è§†é¢‘è§£ç é”™è¯¯',
                4: 'MEDIA_ERR_SRC_NOT_SUPPORTED - è§†é¢‘æ ¼å¼ä¸æ”¯æŒæˆ–æºæ— æ•ˆ'
            };
            return messages[code] || `æœªçŸ¥é”™è¯¯ä»£ç : ${code}`;
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æµ‹ç½‘ç»œç¯å¢ƒ
        window.addEventListener('load', function() {
            console.log('ç½‘ç»œé—®é¢˜è¯Šæ–­é¡µé¢åŠ è½½å®Œæˆ');
            setTimeout(detectNetworkEnvironment, 1000);
        });
    </script>
</body>
</html>
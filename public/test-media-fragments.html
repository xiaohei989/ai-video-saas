<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Media Fragments æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .video-test {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        .video-test h3 {
            margin-top: 0;
            color: #333;
        }
        
        video {
            width: 300px;
            height: 200px;
            border: 2px solid #007cba;
            border-radius: 4px;
        }
        
        .info {
            margin-top: 10px;
            padding: 10px;
            background: #e8f4f8;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .device-info {
            background: #f0f8f0;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ“± Media Fragments ç¼©ç•¥å›¾æµ‹è¯•</h1>
        
        <div class="device-info">
            <h3>ğŸ” è®¾å¤‡æ£€æµ‹ç»“æœ</h3>
            <div id="deviceInfo"></div>
        </div>
        
        <div class="video-test">
            <h3>ğŸ“¹ æµ‹è¯•1: æ™®é€šè§†é¢‘ (æ— Media Fragments)</h3>
            <video 
                src="https://filesystem.site/cdn/sample/video.mp4" 
                preload="metadata"
                muted
                controls
            ></video>
            <div class="info">
                <strong>è¯´æ˜:</strong> æ™®é€šè§†é¢‘å…ƒç´ ï¼Œç§»åŠ¨ç«¯å¯èƒ½ä¸æ˜¾ç¤ºé¢„è§ˆå¸§
            </div>
        </div>
        
        <div class="video-test">
            <h3>ğŸš€ æµ‹è¯•2: Media Fragments (#t=1.0)</h3>
            <video 
                id="video2"
                src="https://filesystem.site/cdn/sample/video.mp4#t=1.0" 
                preload="metadata"
                muted
                controls
                poster=""
                playsinline
            ></video>
            <div class="info">
                <strong>è¯´æ˜:</strong> ä½¿ç”¨Media Fragmentsè·³åˆ°1ç§’ä½ç½®
            </div>
            <div id="debug2" class="info" style="background: #fff8e1; font-family: monospace; font-size: 12px;">ç­‰å¾…åŠ è½½...</div>
        </div>
        
        <div class="video-test">
            <h3>âš¡ æµ‹è¯•3: JavaScriptå¼ºåˆ¶è·³è½¬</h3>
            <video 
                id="video3"
                src="https://filesystem.site/cdn/sample/video.mp4" 
                preload="metadata"
                muted
                poster=""
                playsinline
                style="pointer-events: none;"
            ></video>
            <div class="info">
                <strong>è¯´æ˜:</strong> ä½¿ç”¨JavaScriptæ‰‹åŠ¨è®¾ç½®currentTime
            </div>
            <div id="debug3" class="info" style="background: #fff8e1; font-family: monospace; font-size: 12px;">ç­‰å¾…åŠ è½½...</div>
        </div>

        <div class="video-test">
            <h3>ğŸ¬ æµ‹è¯•4: ä¸åŒè§†é¢‘æº (BigBuckBunny)</h3>
            <video 
                id="video4"
                src="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4#t=2.0" 
                preload="metadata"
                muted
                poster=""
                playsinline
                controls
            ></video>
            <div class="info">
                <strong>è¯´æ˜:</strong> æµ‹è¯•ä¸åŒè§†é¢‘æºçš„Media Fragmentsæ”¯æŒ
            </div>
            <div id="debug4" class="info" style="background: #fff8e1; font-family: monospace; font-size: 12px;">ç­‰å¾…åŠ è½½...</div>
        </div>

        <div class="video-test">
            <h3>ğŸš€ æµ‹è¯•5: R2å­˜å‚¨è§†é¢‘ (å·²è¿ç§»)</h3>
            <video 
                id="video5"
                src="https://pub-e0e4075257f3403f990bacc5d3282fc5.r2.dev/videos/d255e788-bbe7-4321-85d9-b4662743e67a.mp4#t=2.0" 
                preload="metadata"
                muted
                poster=""
                playsinline
                controls
            ></video>
            <div class="info">
                <strong>è¯´æ˜:</strong> æµ‹è¯•å·²è¿ç§»åˆ°R2çš„çœŸå®è§†é¢‘ - Pigeon Takes the Skateboard Challenge
            </div>
            <div id="debug5" class="info" style="background: #fff8e1; font-family: monospace; font-size: 12px;">ç­‰å¾…åŠ è½½...</div>
        </div>

        <div class="video-test">
            <h3>ğŸ¯ æµ‹è¯•6: R2å­˜å‚¨è§†é¢‘2 (ASMR)</h3>
            <video 
                id="video6"
                src="https://pub-e0e4075257f3403f990bacc5d3282fc5.r2.dev/videos/2141b988-8358-40c6-bb5d-233bbcbd47dc.mp4#t=1.0" 
                preload="metadata"
                muted
                poster=""
                playsinline
                controls
            ></video>
            <div class="info">
                <strong>è¯´æ˜:</strong> æµ‹è¯•å·²è¿ç§»åˆ°R2çš„ASMRè§†é¢‘ - Glass Fruit Cutting ASMR
            </div>
            <div id="debug6" class="info" style="background: #fff8e1; font-family: monospace; font-size: 12px;">ç­‰å¾…åŠ è½½...</div>
        </div>

        <div class="video-test">
            <h3>ğŸŒŸ æµ‹è¯•7: å®Œå…¨å…¼å®¹æ–¹æ¡ˆ</h3>
            <div id="container5" style="width: 300px; height: 200px; border: 2px solid #007cba; border-radius: 4px; position: relative; overflow: hidden;">
                <div id="fallback5" style="position: absolute; inset: 0; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; color: white; text-align: center;">
                    <div>
                        <div style="font-size: 48px; margin-bottom: 8px;">ğŸ¬</div>
                        <div style="font-size: 14px; font-weight: bold;">AIç”Ÿæˆè§†é¢‘</div>
                        <div style="font-size: 12px; opacity: 0.8; margin-top: 4px;">ç‚¹å‡»æ’­æ”¾</div>
                    </div>
                </div>
            </div>
            <div class="info">
                <strong>è¯´æ˜:</strong> å¦‚æœæ‰€æœ‰æ–¹æ¡ˆéƒ½å¤±è´¥ï¼Œæ˜¾ç¤ºè¿™ä¸ªç¾è§‚çš„å ä½å›¾
            </div>
            <div id="debug5" class="info" style="background: #fff8e1; font-family: monospace; font-size: 12px;">æ™ºèƒ½fallbackæ–¹æ¡ˆ</div>
        </div>
        
        <div class="video-test">
            <h3>ğŸ“Š æµ‹è¯•ç»“æœ</h3>
            <div id="testResults">
                <p>è¯·æ£€æŸ¥ä¸Šæ–¹çš„è§†é¢‘æ˜¯å¦æ˜¾ç¤ºäº†é¢„è§ˆå¸§...</p>
                <ul>
                    <li><strong>iPhone Safari:</strong> æµ‹è¯•2,3,5,6åº”è¯¥æ˜¾ç¤ºè§†é¢‘ç¬¬ä¸€å¸§</li>
                    <li><strong>iPhone Chrome:</strong> æµ‹è¯•2,3,5,6åº”è¯¥æ˜¾ç¤ºè§†é¢‘ç¬¬ä¸€å¸§</li>
                    <li><strong>Android Chrome:</strong> æµ‹è¯•2,3,5,6åº”è¯¥æ˜¾ç¤ºè§†é¢‘ç¬¬ä¸€å¸§</li>
                    <li><strong>æ¡Œé¢æµè§ˆå™¨:</strong> æ‰€æœ‰æµ‹è¯•éƒ½åº”è¯¥æ­£å¸¸æ˜¾ç¤º</li>
                    <li><strong>é‡ç‚¹æµ‹è¯•:</strong> æµ‹è¯•5å’Œ6æ˜¯R2å­˜å‚¨çš„çœŸå®è§†é¢‘ï¼Œåº”è¯¥åœ¨iOS Chromeä¸­æ­£å¸¸æ˜¾ç¤ºç¼©ç•¥å›¾</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // æ£€æµ‹è®¾å¤‡å’Œæµè§ˆå™¨ä¿¡æ¯
        function detectDevice() {
            const ua = navigator.userAgent;
            const info = [];
            
            // è®¾å¤‡ç±»å‹
            if (/iPhone/i.test(ua)) info.push('ğŸ“± iPhone');
            else if (/iPad/i.test(ua)) info.push('ğŸ“± iPad');
            else if (/Android/i.test(ua)) info.push('ğŸ“± Android');
            else info.push('ğŸ’» æ¡Œé¢è®¾å¤‡');
            
            // æµè§ˆå™¨ç±»å‹
            if (/Safari/i.test(ua) && !/Chrome/i.test(ua)) info.push('ğŸ§­ Safari');
            else if (/Chrome/i.test(ua)) info.push('ğŸŒ Chrome');
            else if (/Firefox/i.test(ua)) info.push('ğŸ¦Š Firefox');
            else info.push('â“ å…¶ä»–æµè§ˆå™¨');
            
            // è§¦æ‘¸æ”¯æŒ
            const touchSupport = 'ontouchstart' in window ? 'âœ…' : 'âŒ';
            info.push(`è§¦æ‘¸æ”¯æŒ: ${touchSupport}`);
            
            // å±å¹•å°ºå¯¸
            info.push(`å±å¹•: ${window.screen.width}x${window.screen.height}`);
            info.push(`çª—å£: ${window.innerWidth}x${window.innerHeight}`);
            
            return info;
        }
        
        // æ˜¾ç¤ºè®¾å¤‡ä¿¡æ¯
        document.getElementById('deviceInfo').innerHTML = detectDevice()
            .map(info => `<div>â€¢ ${info}</div>`)
            .join('');
            
        // æµ‹è¯•Media Fragmentsæ”¯æŒ
        function testMediaFragments() {
            const video = document.createElement('video');
            const hasCurrentTime = 'currentTime' in video;
            const hasCanPlayType = 'canPlayType' in video;
            
            console.log('Media Fragmentsæ”¯æŒæ£€æµ‹:');
            console.log('- currentTimeå±æ€§:', hasCurrentTime);
            console.log('- canPlayTypeæ–¹æ³•:', hasCanPlayType);
            console.log('- ç»¼åˆæ”¯æŒ:', hasCurrentTime && hasCanPlayType);
        }
        
        testMediaFragments();
        
        // æµ‹è¯•2: Media Fragmentsè°ƒè¯•
        const video2 = document.getElementById('video2');
        const debug2 = document.getElementById('debug2');
        
        video2.addEventListener('loadstart', () => {
            debug2.innerHTML = 'ğŸ”„ å¼€å§‹åŠ è½½...';
        });
        
        video2.addEventListener('loadedmetadata', () => {
            debug2.innerHTML = `ğŸ“Š å…ƒæ•°æ®å®Œæˆ | æ—¶é•¿: ${video2.duration.toFixed(1)}s | å½“å‰: ${video2.currentTime.toFixed(1)}s`;
        });
        
        video2.addEventListener('canplay', () => {
            debug2.innerHTML += '<br>âœ… å¯ä»¥æ’­æ”¾';
        });
        
        video2.addEventListener('error', (e) => {
            debug2.innerHTML = `âŒ é”™è¯¯: ${e.type}`;
        });

        // æµ‹è¯•3: JavaScriptå¼ºåˆ¶è·³è½¬
        const video3 = document.getElementById('video3');
        const debug3 = document.getElementById('debug3');
        
        video3.addEventListener('loadedmetadata', () => {
            debug3.innerHTML = 'ğŸ“Š å…ƒæ•°æ®å®Œæˆï¼Œå°è¯•è·³è½¬åˆ°1ç§’...';
            setTimeout(() => {
                video3.currentTime = 1.0;
            }, 100);
        });
        
        video3.addEventListener('seeked', () => {
            debug3.innerHTML += `<br>ğŸ¯ è·³è½¬å®Œæˆ: ${video3.currentTime.toFixed(1)}s`;
        });
        
        video3.addEventListener('timeupdate', () => {
            debug3.innerHTML = `â±ï¸ æ—¶é—´æ›´æ–°: ${video3.currentTime.toFixed(1)}s`;
        });
        
        video3.addEventListener('error', (e) => {
            debug3.innerHTML = `âŒ é”™è¯¯: ${e.type}`;
        });

        // æµ‹è¯•4: BigBuckBunnyè§†é¢‘æº
        const video4 = document.getElementById('video4');
        const debug4 = document.getElementById('debug4');
        
        video4.addEventListener('loadedmetadata', () => {
            debug4.innerHTML = `ğŸ“Š BigBuckBunny | æ—¶é•¿: ${video4.duration.toFixed(1)}s | å½“å‰: ${video4.currentTime.toFixed(1)}s`;
        });
        
        video4.addEventListener('canplay', () => {
            debug4.innerHTML += '<br>âœ… å¯ä»¥æ’­æ”¾';
        });
        
        video4.addEventListener('error', (e) => {
            debug4.innerHTML = `âŒ BigBuckBunnyé”™è¯¯: ${e.type}`;
        });

        // æµ‹è¯•5: R2å­˜å‚¨è§†é¢‘1 (é¸½å­æ»‘æ¿)
        const video5 = document.getElementById('video5');
        const debug5 = document.getElementById('debug5');
        
        video5.addEventListener('loadstart', () => {
            debug5.innerHTML = 'ğŸ”„ R2è§†é¢‘åŠ è½½ä¸­...';
        });
        
        video5.addEventListener('loadedmetadata', () => {
            debug5.innerHTML = `ğŸ“Š R2è§†é¢‘ | æ—¶é•¿: ${video5.duration.toFixed(1)}s | å½“å‰: ${video5.currentTime.toFixed(1)}s`;
        });
        
        video5.addEventListener('canplay', () => {
            debug5.innerHTML += '<br>âœ… R2è§†é¢‘å¯ä»¥æ’­æ”¾';
        });
        
        video5.addEventListener('seeked', () => {
            debug5.innerHTML += `<br>ğŸ¯ è·³è½¬åˆ°: ${video5.currentTime.toFixed(1)}s`;
        });
        
        video5.addEventListener('error', (e) => {
            debug5.innerHTML = `âŒ R2è§†é¢‘é”™è¯¯: ${e.type}`;
        });

        // æµ‹è¯•6: R2å­˜å‚¨è§†é¢‘2 (ASMR)
        const video6 = document.getElementById('video6');
        const debug6 = document.getElementById('debug6');
        
        video6.addEventListener('loadstart', () => {
            debug6.innerHTML = 'ğŸ”„ ASMR R2è§†é¢‘åŠ è½½ä¸­...';
        });
        
        video6.addEventListener('loadedmetadata', () => {
            debug6.innerHTML = `ğŸ“Š ASMR R2è§†é¢‘ | æ—¶é•¿: ${video6.duration.toFixed(1)}s | å½“å‰: ${video6.currentTime.toFixed(1)}s`;
        });
        
        video6.addEventListener('canplay', () => {
            debug6.innerHTML += '<br>âœ… ASMR R2è§†é¢‘å¯ä»¥æ’­æ”¾';
        });
        
        video6.addEventListener('seeked', () => {
            debug6.innerHTML += `<br>ğŸ¯ è·³è½¬åˆ°: ${video6.currentTime.toFixed(1)}s`;
        });
        
        video6.addEventListener('error', (e) => {
            debug6.innerHTML = `âŒ ASMR R2è§†é¢‘é”™è¯¯: ${e.type}`;
        });

        // æµ‹è¯•5: å°è¯•åŠ¨æ€åŠ è½½è§†é¢‘
        setTimeout(() => {
            const container5 = document.getElementById('container5');
            const fallback5 = document.getElementById('fallback5');
            const debug5 = document.getElementById('debug5');
            
            // å°è¯•åˆ›å»ºvideoå…ƒç´ 
            const testVideo = document.createElement('video');
            testVideo.src = 'https://filesystem.site/cdn/sample/video.mp4#t=1.0';
            testVideo.preload = 'metadata';
            testVideo.muted = true;
            testVideo.setAttribute('playsinline', '');
            testVideo.setAttribute('poster', '');
            testVideo.style.width = '100%';
            testVideo.style.height = '100%';
            testVideo.style.objectFit = 'cover';
            
            let loadAttempts = 0;
            const maxAttempts = 3;
            
            function attemptLoad() {
                loadAttempts++;
                debug5.innerHTML = `å°è¯• ${loadAttempts}/${maxAttempts} - åŠ¨æ€åŠ è½½è§†é¢‘...`;
                
                testVideo.addEventListener('loadedmetadata', () => {
                    debug5.innerHTML = `âœ… åŠ¨æ€åŠ è½½æˆåŠŸ | æ—¶é•¿: ${testVideo.duration.toFixed(1)}s`;
                    fallback5.style.opacity = '0';
                    container5.appendChild(testVideo);
                    
                    // å°è¯•è·³è½¬
                    setTimeout(() => {
                        testVideo.currentTime = 1.0;
                    }, 200);
                });
                
                testVideo.addEventListener('error', () => {
                    if (loadAttempts < maxAttempts) {
                        setTimeout(attemptLoad, 1000);
                    } else {
                        debug5.innerHTML = 'ğŸ¨ æ‰€æœ‰æ–¹æ¡ˆå¤±è´¥ï¼Œä½¿ç”¨ç¾è§‚å ä½å›¾';
                        fallback5.style.opacity = '1';
                    }
                });
            }
            
            attemptLoad();
        }, 2000);
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iOSç¼©ç•¥å›¾è°ƒè¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .video-test {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        video {
            width: 280px;
            height: 180px;
            border: 2px solid #007cba;
            border-radius: 4px;
            background: #000;
        }
        
        .info {
            margin-top: 10px;
            padding: 10px;
            background: #e8f4f8;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .debug {
            background: #fff8e1;
            padding: 10px;
            margin-top: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ iOSç¼©ç•¥å›¾è°ƒè¯•å·¥å…·</h1>
        
        <div class="video-test">
            <h3>ğŸ“Š è®¾å¤‡ä¿¡æ¯</h3>
            <div id="deviceInfo" class="info"></div>
        </div>

        <div class="video-test">
            <h3>ğŸ¯ æ–¹æ¡ˆ1: Media Fragments + posteræ¸…ç©º</h3>
            <video 
                id="video1"
                src="https://filesystem.site/cdn/sample/video.mp4#t=0.5" 
                preload="metadata"
                muted
                poster=""
                playsinline
            ></video>
            <div id="debug1" class="debug">ç­‰å¾…åŠ è½½...</div>
        </div>

        <div class="video-test">
            <h3>âš¡ æ–¹æ¡ˆ2: JavaScriptå¼ºåˆ¶è·³è½¬</h3>
            <video 
                id="video2"
                src="https://filesystem.site/cdn/sample/video.mp4" 
                preload="auto"
                muted
                poster=""
                playsinline
            ></video>
            <div id="debug2" class="debug">ç­‰å¾…åŠ è½½...</div>
        </div>

        <div class="video-test">
            <h3>ğŸ”„ æ–¹æ¡ˆ3: Canvasæå– + iOSå…¼å®¹</h3>
            <div style="position: relative;">
                <video 
                    id="video3"
                    src="https://filesystem.site/cdn/sample/video.mp4" 
                    preload="metadata"
                    muted
                    poster=""
                    playsinline
                    style="display: none;"
                ></video>
                <canvas 
                    id="canvas3"
                    width="280" 
                    height="180"
                    style="border: 2px solid #007cba; border-radius: 4px; background: #000;"
                ></canvas>
            </div>
            <div id="debug3" class="debug">ç­‰å¾…åŠ è½½...</div>
        </div>

        <div class="video-test">
            <h3>ğŸŒŸ æ–¹æ¡ˆ4: å¤šé‡fallback</h3>
            <div id="container4" style="width: 280px; height: 180px; border: 2px solid #007cba; border-radius: 4px; background: #000; position: relative; display: flex; align-items: center; justify-content: center;">
                <div style="color: white; text-align: center;">
                    <div style="font-size: 48px;">â–¶ï¸</div>
                    <div style="font-size: 14px;">AIè§†é¢‘</div>
                </div>
            </div>
            <div id="debug4" class="debug">æ™ºèƒ½fallbackæ–¹æ¡ˆ</div>
        </div>
    </div>

    <script>
        // è®¾å¤‡æ£€æµ‹
        function detectDevice() {
            const ua = navigator.userAgent;
            const info = [];
            
            info.push(`UserAgent: ${ua.substring(0, 100)}...`);
            info.push(`Platform: ${navigator.platform}`);
            info.push(`Screen: ${screen.width}x${screen.height}`);
            info.push(`Window: ${window.innerWidth}x${window.innerHeight}`);
            info.push(`Touch: ${'ontouchstart' in window}`);
            info.push(`MaxTouchPoints: ${navigator.maxTouchPoints || 0}`);
            
            // è®¾å¤‡ç±»å‹
            if (/iPhone/i.test(ua)) info.push('Device: iPhone');
            else if (/iPad/i.test(ua)) info.push('Device: iPad');
            else if (/Android/i.test(ua)) info.push('Device: Android');
            else info.push('Device: Desktop');
            
            // æµè§ˆå™¨ç±»å‹
            if (/Safari/i.test(ua) && !/Chrome/i.test(ua)) info.push('Browser: Safari');
            else if (/CriOS/i.test(ua)) info.push('Browser: Chrome iOS');
            else if (/Chrome/i.test(ua)) info.push('Browser: Chrome');
            else if (/Firefox/i.test(ua)) info.push('Browser: Firefox');
            else info.push('Browser: Other');
            
            return info.join('<br>');
        }
        
        document.getElementById('deviceInfo').innerHTML = detectDevice();

        // æ–¹æ¡ˆ1: Media Fragments
        const video1 = document.getElementById('video1');
        const debug1 = document.getElementById('debug1');
        
        video1.addEventListener('loadstart', () => {
            debug1.innerHTML = 'ğŸ”„ å¼€å§‹åŠ è½½...';
        });
        
        video1.addEventListener('loadedmetadata', () => {
            debug1.innerHTML = `ğŸ“Š å…ƒæ•°æ®åŠ è½½å®Œæˆ<br>Duration: ${video1.duration}s<br>CurrentTime: ${video1.currentTime}s`;
        });
        
        video1.addEventListener('canplay', () => {
            debug1.innerHTML += '<br>âœ… å¯ä»¥æ’­æ”¾';
        });
        
        video1.addEventListener('error', (e) => {
            debug1.innerHTML = `âŒ é”™è¯¯: ${e.type}`;
        });

        // æ–¹æ¡ˆ2: JavaScriptå¼ºåˆ¶è·³è½¬
        const video2 = document.getElementById('video2');
        const debug2 = document.getElementById('debug2');
        
        video2.addEventListener('loadedmetadata', () => {
            debug2.innerHTML = 'ğŸ“Š å…ƒæ•°æ®åŠ è½½ï¼Œå°è¯•è·³è½¬åˆ°0.5ç§’...';
            video2.currentTime = 0.5;
        });
        
        video2.addEventListener('seeked', () => {
            debug2.innerHTML += `<br>ğŸ¯ è·³è½¬å®Œæˆï¼Œå½“å‰æ—¶é—´: ${video2.currentTime}s`;
        });
        
        video2.addEventListener('error', (e) => {
            debug2.innerHTML = `âŒ é”™è¯¯: ${e.type}`;
        });

        // æ–¹æ¡ˆ3: Canvasæå–
        const video3 = document.getElementById('video3');
        const canvas3 = document.getElementById('canvas3');
        const debug3 = document.getElementById('debug3');
        
        video3.addEventListener('loadedmetadata', () => {
            debug3.innerHTML = 'ğŸ“Š å…ƒæ•°æ®åŠ è½½ï¼Œå°è¯•Canvasæå–...';
            video3.currentTime = 1.0;
        });
        
        video3.addEventListener('seeked', () => {
            try {
                const ctx = canvas3.getContext('2d');
                ctx.drawImage(video3, 0, 0, 280, 180);
                debug3.innerHTML = 'âœ… Canvasæå–æˆåŠŸ';
            } catch (error) {
                debug3.innerHTML = `âŒ Canvasæå–å¤±è´¥: ${error.message}`;
            }
        });
        
        video3.addEventListener('error', (e) => {
            debug3.innerHTML = `âŒ è§†é¢‘é”™è¯¯: ${e.type}`;
        });

        // æ–¹æ¡ˆ4: å¤šé‡fallbackå°è¯•
        const container4 = document.getElementById('container4');
        const debug4 = document.getElementById('debug4');
        
        // å°è¯•æ‰€æœ‰æ–¹æ¡ˆ
        function attemptThumbnailGeneration() {
            const testVideo = document.createElement('video');
            testVideo.src = 'https://filesystem.site/cdn/sample/video.mp4#t=1.0';
            testVideo.preload = 'metadata';
            testVideo.muted = true;
            testVideo.playsInline = true;
            
            let attempts = 0;
            const maxAttempts = 3;
            
            function tryMethod() {
                attempts++;
                debug4.innerHTML = `å°è¯•æ–¹æ¡ˆ ${attempts}/${maxAttempts}...`;
                
                if (attempts === 1) {
                    // æ–¹æ³•1: Media Fragments
                    testVideo.style.width = '280px';
                    testVideo.style.height = '180px';
                    testVideo.style.objectFit = 'cover';
                    container4.innerHTML = '';
                    container4.appendChild(testVideo);
                    
                    setTimeout(() => {
                        if (testVideo.readyState >= 1) {
                            debug4.innerHTML = 'âœ… Media FragmentsæˆåŠŸ';
                        } else {
                            tryMethod();
                        }
                    }, 2000);
                    
                } else if (attempts === 2) {
                    // æ–¹æ³•2: å¼ºåˆ¶currentTime
                    testVideo.addEventListener('loadedmetadata', () => {
                        testVideo.currentTime = 1.0;
                        setTimeout(() => {
                            debug4.innerHTML = 'âœ… CurrentTimeæ–¹æ³•';
                        }, 1000);
                    });
                    
                } else {
                    // æ–¹æ³•3: ä¼˜é›…fallback
                    container4.innerHTML = `
                        <div style="color: white; text-align: center;">
                            <div style="font-size: 48px;">ğŸ¬</div>
                            <div style="font-size: 14px; margin-top: 8px;">AIç”Ÿæˆè§†é¢‘</div>
                            <div style="font-size: 10px; margin-top: 4px; opacity: 0.8;">ç‚¹å‡»æ’­æ”¾</div>
                        </div>
                    `;
                    debug4.innerHTML = 'ğŸ¨ ä½¿ç”¨ä¼˜é›…å ä½å›¾';
                }
            }
            
            tryMethod();
        }
        
        // å»¶è¿Ÿæ‰§è¡Œé¿å…é˜»å¡
        setTimeout(attemptThumbnailGeneration, 1000);
    </script>
</body>
</html>